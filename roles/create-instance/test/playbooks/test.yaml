---
- hosts: localhost
  gather_facts: no
  vars_files:
  - ../openstack.yaml
  - ../vars.yaml
  pre_tasks:
#  - name: Create project
#    os_project:
#       state: present
#       cloud: "{{ os_admin }}"
#       name: "{{ user_project }}"
#       description: OCP 3.x Project
#       domain_id: "{{ user_domain }}"
#       enabled: True
# 
#  - name: Create user
#    os_user:
#       state: present
#       cloud: "{{ os_admin }}"
#       name: "{{ user_name }}"
#       password: "{{ user_pw }}"
#       email: "{{ user_email }}"
#       domain: "{{ user_domain }}"
#       default_project: "{{ user_project }}"
#
#  - name: Associate roles
#    os_user_role:
#       cloud: "{{ os_admin }}"
#       user: "{{ user_name }}"
#       role: "member"
#       project: "{{ user_project }}"

  - import_role:
      name: new-user-process
    when: retest is not defined
  tasks:
  - import_role:
      name: create-instance
